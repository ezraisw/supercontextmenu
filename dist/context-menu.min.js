/*!
 * Super Context Menu
 * Created by EZ17-1, pwnedgod @ github
 */
"use strict";window.superCm=function(e){function n(e,n){var t=T[e];return t.search.result&&!n?t.search.result:t.opts}function t(e){return T[e].element.find(".context-menu-options")}function o(e){return t(e).children()}function i(e,n){return t(e).children().eq(n)}function s(e,n){if(null==M||M.cmIndex!=e||M.optIndex!=n){if(null!=M){let e=i(M.cmIndex,M.optIndex);e.hasClass("active")&&e.removeClass("active")}if(e!=-1&&n!=-1){let t=i(e,n);t.hasClass("active")||t.addClass("active"),M={cmIndex:e,optIndex:n}}else M=null}}function a(e,n){var t=T[e].activeSubmenu;if(t!=n){if(t!=-1){let n=i(e,t);n.hasClass("active-submenu")&&n.removeClass("active-submenu")}if(n!=-1){let t=i(e,n);t.hasClass("active-submenu")||t.addClass("active-submenu")}T[e].activeSubmenu=n}}function r(e){void 0===e&&(e=0),null!=M&&e<=M.cmIndex&&s(-1,-1);for(let n=T.length-1;n>=e;n--)T.pop().element.remove()}function u(e){var u=T[e],l=n(e,!1);0==l.length&&(l=[{label:"&lt; Empty &gt;",disabled:!0}]),l.forEach(function(n,o){var l=i(e,o),c=void 0!==n.separator,d=void 0!==n.icon&&n.icon,m=void 0!==n.label&&n.label,f=void 0!==n.disabled&&n.disabled,h=void 0!==n.action&&n.action,v=void 0!==n.submenu&&n.submenu;return l.length?(l.empty(),l.off(),l.removeClass()):(l=w.clone(),l.appendTo(t(e))),c?(l.hasClass("context-menu-separator")||l.addClass("context-menu-separator"),void l.append(y.clone())):(d&&l.append(I.clone().addClass(n.icon)),m&&l.append(C.clone().html(n.label)),f?void(l.hasClass("context-menu-disabled")||l.addClass("context-menu-disabled")):(h&&l.click(function(){x.autoClose?r():(r(e+1),a(e,-1)),n.action(n,e,o)}),v?(l.on("submenu",function(){if(u.activeSubmenu!=o){var i=e+1;a(e,o),r(i),p(n.submenu,i,{x:u.position.x+u.element.outerWidth(),y:u.position.y+this.offsetTop-this.parentElement.scrollTop-parseInt(t(e).css("padding-top"))})}}),l.mouseenter(function(){s(e,o),$(this).trigger("submenu")}),l.hasClass("context-menu-submenu")||l.addClass("context-menu-submenu")):(l.mouseenter(function(){s(e,o),a(e,-1),r(e+1)}),l.hasClass("context-menu-option")||l.addClass("context-menu-option")),void l.mouseleave(function(){M.cmIndex==e&&M.optIndex==o&&s(-1,-1)})))});var c=o(e);for(let e=c.length-1;e>=l.length;e--)c.eq(e).remove()}function l(n,s,a){void 0===s&&(s=!0),void 0===a&&(a=!0);var r=T[n];if(n>0){var u=n-1,l=T[u],c=i(u,l.activeSubmenu);r.position={x:l.position.x+l.element.outerWidth(),y:l.position.y+c[0].offsetTop-c[0].parentElement.scrollTop-parseInt(t(n).css("padding-top"))}}if(s){var d=r.element.outerWidth();r.position.x-$(window).scrollLeft()+d>=$(window).innerWidth()&&(r.position.x-=d,n>0&&(r.position.x-=l.element.outerWidth()),r.position.x<$(window).scrollLeft()&&(r.position.x=$(window).scrollLeft())),r.element.css("left",r.position.x+"px")}if(a){var p=r.element.outerHeight();if(r.position.y-$(window).scrollTop()+p>=$(window).innerHeight()){if(r.position.y-=p,n>0){var m=parseInt(t(n).css("padding-bottom")),f=o(n).last(),h=parseInt(t(n).css("padding-top"));r.position.y+=m+h+f.outerHeight()}r.position.y<$(window).scrollTop()&&(r.position.y=$(window).scrollTop())}r.element.css("top",r.position.y+"px")}if(null===x.maxHeight){var v=r.position.y-$(window).scrollTop(),g="calc(100vh - "+v+"px)";e?r.element.outerHeight()>$(window).innerHeight()-v&&r.element.css("height",g):r.element.css("max-height",g)}else r.element.css("max-height",x.maxHeight);null!==x.minWidth&&r.element.css("min-width",x.minWidth),r.element.css("z-index",x.zIndex+n)}function c(e,n,t){n.forEach(function(n){var o=!1;if(void 0!==n.label&&n.label){var i=n.label.toLowerCase();i&&i.indexOf(t)!=-1&&(e.push(n),o=!0)}!o&&void 0!==n.submenu&&n.submenu.length&&c(e,n.submenu,t)})}function d(e){var n=T[e];if(null!==n.search.input){var t=n.search.input.val().trim();if(""==t)return n.search.result=null,void u(e);s(-1,-1);var o=[];c(o,n.opts,t.toLowerCase()),n.search.result=o}}function p(e,n,o){var i=g.clone();if(x.searchBar&&0==n){var c=b.clone();c.prependTo(i)}var p={element:i,position:o,opts:e,activeSubmenu:-1,search:{input:c?c.find("input"):null,result:null}};T.push(p),t(n).scroll(function(){a(n,-1),r(n+1)}),s(-1,-1),M={cmIndex:n,optIndex:-1},i.appendTo(document.body),u(n),l(n),c&&p.search.input.on("input",function(){r(n+1),d(n),u(n),l(n,!0,!1)}).focus()}function m(e,t){var o=n(e,!1)[t];return void 0===o.separator&&(void 0===o.disabled||!o.disabled)}function f(e,n,t){var i=o(e);n>=i.length?n=0:n<0&&(n=i.length-1);for(var s=n;!m(e,s);){if((s+=t?-1:1)==n)return-1;s>=i.length?s=0:s<0&&(s=i.length-1)}return s}function h(){if(null==M||M.optIndex==-1){var e=T.length-1,t=n(e);if(t.length<=0)return;return void s(e,t.length-1)}var o=f(M.cmIndex,M.optIndex-1,!0);o!=-1&&s(M.cmIndex,o)}function v(){if(null==M||M.optIndex==-1){var e=T.length-1;if(n(e).length<=0)return;return void s(e,0)}var t=f(M.cmIndex,M.optIndex+1,!1);t!=-1&&s(M.cmIndex,t)}var x={minWidth:null,maxHeight:null,autoClose:!1,searchBar:!1,searchBarPlaceholder:"Search...",zIndex:50},g=$("<div>").addClass("context-menu").append($("<div>").addClass("context-menu-options")),w=$("<div>"),b=$("<div>").addClass("context-menu-search").append($("<input>").prop({type:"text",placeholder:x.searchBarPlaceholder})),I=$("<i>").addClass("option-icon"),C=$("<span>").addClass("option-text"),y=$("<hr>").addClass("option-separator"),T=[],M=null;return $(document).on("mousedown.scm contextmenu.scm",".context-menu, .opt-text, .opt-icon, .opt-separator",function(e){e.stopPropagation()}),$(document).on("keydown.scm",function(e){if("Escape"!=e.key&&27!=e.which||r(),T.length>0)if("ArrowUp"==e.key||38==e.which)e.preventDefault(),h();else if("ArrowDown"==e.key||40==e.which)e.preventDefault(),v();else if("Enter"==e.key||13==e.which)e.preventDefault(),i(M.cmIndex,M.optIndex).click();else if("ArrowLeft"==e.key||37==e.which){if(null!=M&&M.cmIndex>0){e.preventDefault();var n=M.cmIndex-1,t=T[n],o=t.activeSubmenu;r(M.cmIndex),a(n,-1),s(n,o)}}else if(("ArrowRight"==e.key||39==e.which)&&null!=M&&M.optIndex!=-1){var u=i(M.cmIndex,M.optIndex);u.hasClass("context-menu-submenu")&&(e.preventDefault(),u.trigger("submenu"))}}),$(document).on("mousedown.scm",function(){r()}),$(window).on("scroll.scm resize.scm",function(){r()}),{settings:x,createMenu:function(e,n){r(),p(e,0,{x:n.pageX,y:n.pageY})},destroyMenu:function(){r()},updateMenu:function(e,n){T.forEach(function(t,o){d(o),u(o),l(o,e,n)})},getMenuOptions:function(e){return T[e].opts},addMenuOption:function(e,n,t){void 0!==t?T[e].opts.splice(t,0,n):T[e].opts.push(n)},addMenuOptions:function(e,n,t){void 0!==t?Array.prototype.splice.apply(T[e].opts,[t,0].concat(n)):T[e].opts=T[e].opts.concat(n)},deleteMenuOption:function(e,n){T[e].opts.splice(n,1)},setMenuOption:function(e,n,t){T[e].opts[n]=t},setMenuOptions:function(e,n){T[e].opts=n}}}("Microsoft Internet Explorer"==navigator.appName||/Trident/.test(navigator.userAgent)||/rv:11/.test(navigator.userAgent));