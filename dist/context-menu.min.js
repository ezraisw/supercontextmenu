/*!
 * Super Context Menu
 * Created by EZ17-1, pwnedgod @ github
 */
"use strict";window.superCm=function(e){var n={minWidth:null,maxHeight:null,autoClose:!1,searchBar:!1,searchBarPlaceholder:"Search...",zIndex:50},t=$("<div>").addClass("context-menu").append($("<div>").addClass("context-menu-options")),o=$("<div>"),i=$("<div>").addClass("context-menu-search").append($("<input>").prop({type:"text",placeholder:n.searchBarPlaceholder})),s=$("<i>").addClass("option-icon"),a=$("<span>").addClass("option-text"),l=$("<hr>").addClass("option-separator"),u=[],r=null;function c(e,n){var t=u[e];return t.search.result&&!n?t.search.result:t.opts}function d(e){return u[e].element.find(".context-menu-options")}function p(e){return d(e).children()}function m(e,n){return d(e).children().eq(n)}function f(e,n){if(null==r||r.cmIndex!=e||r.optIndex!=n){if(null!=r){let e=m(r.cmIndex,r.optIndex);e.hasClass("active")&&e.removeClass("active")}if(-1!=e&&-1!=n){let t=m(e,n);t.hasClass("active")||t.addClass("active"),r={cmIndex:e,optIndex:n}}else r=null}}function h(e,n){var t=u[e].activeSubmenu;if(t!=n){if(-1!=t){let n=m(e,t);n.hasClass("active-submenu")&&n.removeClass("active-submenu")}if(-1!=n){let t=m(e,n);t.hasClass("active-submenu")||t.addClass("active-submenu")}u[e].activeSubmenu=n}}function v(e){void 0===e&&(e=0),null!=r&&e<=r.cmIndex&&f(-1,-1);for(let n=u.length-1;n>=e;n--)u.pop().element.remove()}function x(e){var t=u[e],i=c(e,!1);0==i.length&&(i=[{label:"&lt; Empty &gt;",disabled:!0}]),i.forEach(function(i,u){var c=m(e,u),p=void 0!==i.separator,x=void 0!==i.icon&&i.icon,g=void 0!==i.label&&i.label,w=void 0!==i.disabled&&i.disabled,I=void 0!==i.action&&i.action,C=void 0!==i.submenu&&i.submenu;if(c.length?(c.empty(),c.off(),c.removeClass()):(c=o.clone()).appendTo(d(e)),p)return c.hasClass("context-menu-separator")||c.addClass("context-menu-separator"),void c.append(l.clone());x&&c.append(s.clone().addClass(i.icon)),g&&c.append(a.clone().html(i.label)),w?c.hasClass("context-menu-disabled")||c.addClass("context-menu-disabled"):(I&&c.click(function(){n.autoClose?v():(v(e+1),h(e,-1)),i.action(i,e,u)}),C?(c.on("submenu",function(){if(t.activeSubmenu!=u){var n=e+1;h(e,u),v(n),b(i.submenu,n,{x:t.position.x+t.element.outerWidth(),y:t.position.y+this.offsetTop-this.parentElement.scrollTop-parseInt(d(e).css("padding-top"))})}}),c.mouseenter(function(){f(e,u),$(this).trigger("submenu")}),c.hasClass("context-menu-submenu")||c.addClass("context-menu-submenu")):(c.mouseenter(function(){f(e,u),h(e,-1),v(e+1)}),c.hasClass("context-menu-option")||c.addClass("context-menu-option")),c.mouseleave(function(){r.cmIndex==e&&r.optIndex==u&&f(-1,-1)}))});var x=p(e);for(let e=x.length-1;e>=i.length;e--)x.eq(e).remove()}function g(t,o,i){void 0===o&&(o=!0),void 0===i&&(i=!0);var s=u[t];if(t>0){var a=t-1,l=u[a],r=m(a,l.activeSubmenu);s.position={x:l.position.x+l.element.outerWidth(),y:l.position.y+r[0].offsetTop-r[0].parentElement.scrollTop-parseInt(d(t).css("padding-top"))}}if(o){var c=s.element.outerWidth();s.position.x-$(window).scrollLeft()+c>=$(window).innerWidth()&&(s.position.x-=c,t>0&&(s.position.x-=l.element.outerWidth()),s.position.x<$(window).scrollLeft()&&(s.position.x=$(window).scrollLeft())),s.element.css("left",s.position.x)}var f=s.element.outerHeight();if(i){if(s.position.y-$(window).scrollTop()+f>=$(window).innerHeight()){if(s.position.y-=f,t>0){var h=parseInt(d(t).css("padding-bottom")),v=p(t).last(),x=parseInt(d(t).css("padding-top"));s.position.y+=h+x+v.outerHeight()}s.position.y<$(window).scrollTop()&&(s.position.y=$(window).scrollTop())}s.element.css("top",s.position.y)}if(null===n.maxHeight){var g=s.position.y-$(window).scrollTop();if(e){let e=$(window).innerHeight()-g;f>e&&s.element.css("height",e)}else s.element.css("max-height","calc(100vh - "+g+"px)")}else e?f>n.maxHeight&&s.element.css("height",n.maxHeight):s.element.css("max-height",n.maxHeight);null!==n.minWidth&&s.element.css("min-width",n.minWidth),s.element.css("z-index",n.zIndex+t)}function w(e){var n=u[e];if(null!==n.search.input){var t=n.search.input.val().trim();if(""==t)return n.search.result=null,void x(e);f(-1,-1);var o=[];!function e(n,t,o){t.forEach(function(t){var i=!1;if(void 0!==t.label&&t.label){var s=t.label.toLowerCase();s&&-1!=s.indexOf(o)&&(n.push(t),i=!0)}!i&&void 0!==t.submenu&&t.submenu.length&&e(n,t.submenu,o)})}(o,n.opts,t.toLowerCase()),n.search.result=o}}function b(e,o,s){var a=t.clone();if(n.searchBar&&0==o){var l=i.clone();l.prependTo(a)}var c={element:a,position:s,opts:e,activeSubmenu:-1,search:{input:l?l.find("input"):null,result:null}};u.push(c),d(o).scroll(function(){h(o,-1),v(o+1)}),f(-1,-1),r={cmIndex:o,optIndex:-1},a.appendTo(document.body),x(o),g(o),l&&c.search.input.on("input",function(){v(o+1),w(o),x(o),g(o,!0,!1)}).focus()}function I(e,n){var t=c(e,!1)[n];return void 0===t.separator&&(void 0===t.disabled||!t.disabled)}function C(e,n,t){var o=p(e);n>=o.length?n=0:n<0&&(n=o.length-1);for(var i=n;!I(e,i);){if((i+=t?-1:1)==n)return-1;i>=o.length?i=0:i<0&&(i=o.length-1)}return i}return $(document).on("mousedown.scm contextmenu.scm",".context-menu, .opt-text, .opt-icon, .opt-separator",function(e){e.stopPropagation()}),$(document).on("keydown.scm",function(e){if("Escape"!=e.key&&27!=e.which||v(),u.length>0)if("ArrowUp"==e.key||38==e.which)e.preventDefault(),function(){if(null!=r&&-1!=r.optIndex){var e=C(r.cmIndex,r.optIndex-1,!0);-1!=e&&f(r.cmIndex,e)}else{var n=u.length-1,t=c(n);if(t.length<=0)return;f(n,t.length-1)}}();else if("ArrowDown"==e.key||40==e.which)e.preventDefault(),function(){if(null!=r&&-1!=r.optIndex){var e=C(r.cmIndex,r.optIndex+1,!1);-1!=e&&f(r.cmIndex,e)}else{var n=u.length-1;if(c(n).length<=0)return;f(n,0)}}();else if("Enter"==e.key||13==e.which)e.preventDefault(),m(r.cmIndex,r.optIndex).click();else if("ArrowLeft"==e.key||37==e.which){if(null!=r&&r.cmIndex>0){e.preventDefault();var n=r.cmIndex-1,t=u[n].activeSubmenu;v(r.cmIndex),h(n,-1),f(n,t)}}else if(("ArrowRight"==e.key||39==e.which)&&null!=r&&-1!=r.optIndex){var o=m(r.cmIndex,r.optIndex);o.hasClass("context-menu-submenu")&&(e.preventDefault(),o.trigger("submenu"))}}),$(document).on("mousedown.scm",function(){v()}),$(window).on("scroll.scm resize.scm",function(){v()}),{settings:n,createMenu:function(e,n){v(),b(e,0,{x:n.pageX,y:n.pageY})},destroyMenu:function(){v()},updateMenu:function(e,n){u.forEach(function(t,o){w(o),x(o),g(o,e,n)})},getMenuOptions:function(e){return u[e].opts},addMenuOption:function(e,n,t){void 0!==t?u[e].opts.splice(t,0,n):u[e].opts.push(n)},addMenuOptions:function(e,n,t){void 0!==t?Array.prototype.splice.apply(u[e].opts,[t,0].concat(n)):u[e].opts=u[e].opts.concat(n)},deleteMenuOption:function(e,n){u[e].opts.splice(n,1)},setMenuOption:function(e,n,t){u[e].opts[n]=t},setMenuOptions:function(e,n){u[e].opts=n},isOpen:function(){return 0!==$(".context-menu").length}}}("Microsoft Internet Explorer"==navigator.appName||/Trident/.test(navigator.userAgent)||/rv:11/.test(navigator.userAgent));