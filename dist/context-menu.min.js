/*!
 * Super Context Menu
 * Created by EZ17-1, pwnedgod @ github
 */
"use strict";window.superCm=function(){function e(e,n){var t=y[e];return t.search.result&&!n?t.search.result:t.opts}function n(e){return y[e].element.find(".context-menu-options")}function t(e){return n(e).children()}function o(e,t){return n(e).children().eq(t)}function i(e,n){if(null==T||T.cmIndex!=e||T.optIndex!=n){if(null!=T){let e=o(T.cmIndex,T.optIndex);e.hasClass("active")&&e.removeClass("active")}if(e!=-1&&n!=-1){let t=o(e,n);t.hasClass("active")||t.addClass("active"),T={cmIndex:e,optIndex:n}}else T=null}}function s(e,n){var t=y[e].activeSubmenu;if(t!=n){if(t!=-1){let n=o(e,t);n.hasClass("active-submenu")&&n.removeClass("active-submenu")}if(n!=-1){let t=o(e,n);t.hasClass("active-submenu")||t.addClass("active-submenu")}y[e].activeSubmenu=n}}function a(e=0){null!=T&&e<=T.cmIndex&&i(-1,-1);for(let n=y.length-1;n>=e;n--)y.pop().element.remove()}function u(u){var l=y[u],r=e(u,!1);0==r.length&&(r=[{label:"&lt; Empty &gt;",disabled:!0}]),r.forEach(function(e,t){var r=o(u,t),c=void 0!==e.separator,p=void 0!==e.icon&&e.icon,m=void 0!==e.label&&e.label,f=void 0!==e.disabled&&e.disabled,h=void 0!==e.action&&e.action,x=void 0!==e.submenu&&e.submenu;return r.length?(r.empty(),r.off(),r.removeClass()):(r=g.clone(),r.appendTo(n(u))),c?(r.hasClass("context-menu-separator")||r.addClass("context-menu-separator"),void r.append(C.clone())):(p&&r.append(b.clone().addClass(e.icon)),m&&r.append(I.clone().html(e.label)),f?void(r.hasClass("context-menu-disabled")||r.addClass("context-menu-disabled")):(h&&r.click(function(){v.autoClose?a():(a(u+1),s(u,-1)),e.action(e,u,t)}),x?(r.on("submenu",function(){if(l.activeSubmenu!=t){var o=u+1;s(u,t),a(o),d(e.submenu,o,{x:l.position.x+l.element.outerWidth(),y:l.position.y+this.offsetTop-this.parentElement.scrollTop-parseInt(n(u).css("padding-top"))})}}),r.mouseenter(function(){i(u,t),$(this).trigger("submenu")}),r.hasClass("context-menu-submenu")||r.addClass("context-menu-submenu")):(r.mouseenter(function(){i(u,t),s(u,-1),a(u+1)}),r.hasClass("context-menu-option")||r.addClass("context-menu-option")),void r.mouseleave(function(){T.cmIndex==u&&T.optIndex==t&&i(-1,-1)})))});var c=t(u);for(let e=c.length-1;e>=r.length;e--)c.eq(e).remove()}function l(e,i=!0,s=!0){var a=y[e];if(e>0){var u=e-1,l=y[u],r=o(u,l.activeSubmenu);a.position={x:l.position.x+l.element.outerWidth(),y:l.position.y+r[0].offsetTop-r[0].parentElement.scrollTop-parseInt(n(e).css("padding-top"))}}if(i){var c=a.element.outerWidth();a.position.x-$(window).scrollLeft()+c>=$(window).innerWidth()&&(a.position.x-=c,e>0&&(a.position.x-=l.element.outerWidth()),a.position.x<$(window).scrollLeft()&&(a.position.x=$(window).scrollLeft())),a.element.css("left",`${a.position.x}px`)}if(s){var d=a.element.outerHeight();if(a.position.y-$(window).scrollTop()+d>=$(window).innerHeight()){if(a.position.y-=d,e>0){var p=parseInt(n(e).css("padding-bottom")),m=t(e).last(),f=parseInt(n(e).css("padding-top"));a.position.y+=p+f+m.outerHeight()}a.position.y<$(window).scrollTop()&&(a.position.y=$(window).scrollTop())}a.element.css("top",`${a.position.y}px`)}if(null===v.maxHeight){var h=a.position.y-$(window).scrollTop();a.element.css("max-height",`calc(100vh - ${h}px)`)}else a.element.css("max-height",v.maxHeight);null!==v.minWidth&&a.element.css("min-width",v.minWidth),a.element.css("z-index",v.zIndex+e)}function r(e,n,t){n.forEach(function(n){var o=!1;if(void 0!==n.label&&n.label){var i=n.label.toLowerCase();i&&i.indexOf(t)!=-1&&(e.push(n),o=!0)}!o&&void 0!==n.submenu&&n.submenu.length&&r(e,n.submenu,t)})}function c(e){var n=y[e];if(null!==n.search.input){var t=n.search.input.val().trim();if(""==t)return n.search.result=null,void u(e);i(-1,-1);var o=[];r(o,n.opts,t.toLowerCase()),n.search.result=o}}function d(e,t,o=null){var r=x.clone();if(v.searchBar&&0==t){var d=w.clone();d.prependTo(r)}var p={element:r,position:o,opts:e,activeSubmenu:-1,search:{input:d?d.find("input"):null,result:null}};y.push(p),n(t).scroll(function(){s(t,-1),a(t+1)}),i(-1,-1),T={cmIndex:t,optIndex:-1},r.appendTo(document.body),u(t),l(t),d&&p.search.input.on("input",function(){a(t+1),c(t),u(t),l(t,!0,!1)}).focus()}function p(n,t){var o=e(n,!1)[t];return void 0===o.separator&&(void 0===o.disabled||!o.disabled)}function m(e,n,o){var i=t(e);n>=i.length?n=0:n<0&&(n=i.length-1);for(var s=n;!p(e,s);){if((s+=o?-1:1)==n)return-1;s>=i.length?s=0:s<0&&(s=i.length-1)}return s}function f(){if(null==T||T.optIndex==-1){var n=y.length-1,t=e(n);if(t.length<=0)return;return void i(n,t.length-1)}var o=m(T.cmIndex,T.optIndex-1,!0);o!=-1&&i(T.cmIndex,o)}function h(){if(null==T||T.optIndex==-1){var n=y.length-1;if(e(n).length<=0)return;return void i(n,0)}var t=m(T.cmIndex,T.optIndex+1,!1);t!=-1&&i(T.cmIndex,t)}var v={minWidth:null,maxHeight:null,autoClose:!1,searchBar:!1,searchBarPlaceholder:"Search...",zIndex:50},x=$("<div>").addClass("context-menu").append($("<div>").addClass("context-menu-options")),g=$("<div>"),w=$("<div>").addClass("context-menu-search").append($("<input>").prop({type:"text",placeholder:v.searchBarPlaceholder})),b=$("<i>").addClass("option-icon"),I=$("<span>").addClass("option-text"),C=$("<hr>").addClass("option-separator"),y=[],T=null;return $(document).on("mousedown contextmenu",".context-menu, .opt-text, .opt-icon, .opt-separator",function(e){e.stopPropagation()}),$(document).keydown(function(e){if("Escape"!=e.key&&27!=e.which||a(),y.length>0)if("ArrowUp"==e.key||38==e.which)e.preventDefault(),f();else if("ArrowDown"==e.key||40==e.which)e.preventDefault(),h();else if("Enter"==e.key||13==e.which)e.preventDefault(),o(T.cmIndex,T.optIndex).click();else if("ArrowLeft"==e.key||37==e.which){if(null!=T&&T.cmIndex>0){e.preventDefault();var n=T.cmIndex-1,t=y[n],u=t.activeSubmenu;a(T.cmIndex),s(n,-1),i(n,u)}}else if(("ArrowRight"==e.key||39==e.which)&&null!=T&&T.optIndex!=-1){var l=o(T.cmIndex,T.optIndex);l.hasClass("context-menu-submenu")&&(e.preventDefault(),l.trigger("submenu"))}}),$(document).mousedown(function(){a()}),$(window).on("scroll resize",function(){a()}),{settings:v,createMenu:function(e,n){a(),d(e,0,{x:n.pageX,y:n.pageY})},destroyMenu:function(){a()},updateMenu:function(e,n){y.forEach(function(t,o){c(o),u(o),l(o,e,n)})},getMenuOptions:function(e){return y[e].opts},addMenuOption:function(e,n,t){void 0!==t?y[e].opts.splice(t,0,n):y[e].opts.push(n)},addMenuOptions:function(e,n,t){void 0!==t?y[e].opts.splice(t,0,...n):y[e].opts=y[e].opts.concat(n)},deleteMenuOption:function(e,n){y[e].opts.splice(n,1)},setMenuOption:function(e,n,t){y[e].opts[n]=t},setMenuOptions:function(e,n){y[e].opts=n}}}();