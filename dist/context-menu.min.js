/*!
 * Super Context Menu
 * Created by EZ17-1, pwnedgod @ github
 */
"use strict";window.superCm=function(e){function n(e,n){var t=T[e];return t.search.result&&!n?t.search.result:t.opts}function t(e){return T[e].element.find(".context-menu-options")}function o(e){return t(e).children()}function i(e,n){return t(e).children().eq(n)}function s(e,n){if(null==M||M.cmIndex!=e||M.optIndex!=n){if(null!=M){let e=i(M.cmIndex,M.optIndex);e.hasClass("active")&&e.removeClass("active")}if(e!=-1&&n!=-1){let t=i(e,n);t.hasClass("active")||t.addClass("active"),M={cmIndex:e,optIndex:n}}else M=null}}function a(e,n){var t=T[e].activeSubmenu;if(t!=n){if(t!=-1){let n=i(e,t);n.hasClass("active-submenu")&&n.removeClass("active-submenu")}if(n!=-1){let t=i(e,n);t.hasClass("active-submenu")||t.addClass("active-submenu")}T[e].activeSubmenu=n}}function l(e){void 0===e&&(e=0),null!=M&&e<=M.cmIndex&&s(-1,-1);for(let n=T.length-1;n>=e;n--)T.pop().element.remove()}function r(e){var r=T[e],u=n(e,!1);0==u.length&&(u=[{label:"&lt; Empty &gt;",disabled:!0}]),u.forEach(function(n,o){var u=i(e,o),c=void 0!==n.separator,d=void 0!==n.icon&&n.icon,m=void 0!==n.label&&n.label,f=void 0!==n.disabled&&n.disabled,h=void 0!==n.action&&n.action,v=void 0!==n.submenu&&n.submenu;return u.length?(u.empty(),u.off(),u.removeClass()):(u=w.clone(),u.appendTo(t(e))),c?(u.hasClass("context-menu-separator")||u.addClass("context-menu-separator"),void u.append(y.clone())):(d&&u.append(I.clone().addClass(n.icon)),m&&u.append(C.clone().html(n.label)),f?void(u.hasClass("context-menu-disabled")||u.addClass("context-menu-disabled")):(h&&u.click(function(){x.autoClose?l():(l(e+1),a(e,-1)),n.action(n,e,o)}),v?(u.on("submenu",function(){if(r.activeSubmenu!=o){var i=e+1;a(e,o),l(i),p(n.submenu,i,{x:r.position.x+r.element.outerWidth(),y:r.position.y+this.offsetTop-this.parentElement.scrollTop-parseInt(t(e).css("padding-top"))})}}),u.mouseenter(function(){s(e,o),$(this).trigger("submenu")}),u.hasClass("context-menu-submenu")||u.addClass("context-menu-submenu")):(u.mouseenter(function(){s(e,o),a(e,-1),l(e+1)}),u.hasClass("context-menu-option")||u.addClass("context-menu-option")),void u.mouseleave(function(){M.cmIndex==e&&M.optIndex==o&&s(-1,-1)})))});var c=o(e);for(let e=c.length-1;e>=u.length;e--)c.eq(e).remove()}function u(n,s,a){void 0===s&&(s=!0),void 0===a&&(a=!0);var l=T[n];if(n>0){var r=n-1,u=T[r],c=i(r,u.activeSubmenu);l.position={x:u.position.x+u.element.outerWidth(),y:u.position.y+c[0].offsetTop-c[0].parentElement.scrollTop-parseInt(t(n).css("padding-top"))}}if(s){var d=l.element.outerWidth();l.position.x-$(window).scrollLeft()+d>=$(window).innerWidth()&&(l.position.x-=d,n>0&&(l.position.x-=u.element.outerWidth()),l.position.x<$(window).scrollLeft()&&(l.position.x=$(window).scrollLeft())),l.element.css("left",l.position.x)}var p=l.element.outerHeight();if(a){if(l.position.y-$(window).scrollTop()+p>=$(window).innerHeight()){if(l.position.y-=p,n>0){var m=parseInt(t(n).css("padding-bottom")),f=o(n).last(),h=parseInt(t(n).css("padding-top"));l.position.y+=m+h+f.outerHeight()}l.position.y<$(window).scrollTop()&&(l.position.y=$(window).scrollTop())}l.element.css("top",l.position.y)}if(null===x.maxHeight){var v=l.position.y-$(window).scrollTop();if(e){let e=$(window).innerHeight()-v;p>e&&l.element.css("height",e)}else l.element.css("max-height","calc(100vh - "+v+"px)")}else e?p>x.maxHeight&&l.element.css("height",x.maxHeight):l.element.css("max-height",x.maxHeight);null!==x.minWidth&&l.element.css("min-width",x.minWidth),l.element.css("z-index",x.zIndex+n)}function c(e,n,t){n.forEach(function(n){var o=!1;if(void 0!==n.label&&n.label){var i=n.label.toLowerCase();i&&i.indexOf(t)!=-1&&(e.push(n),o=!0)}!o&&void 0!==n.submenu&&n.submenu.length&&c(e,n.submenu,t)})}function d(e){var n=T[e];if(null!==n.search.input){var t=n.search.input.val().trim();if(""==t)return n.search.result=null,void r(e);s(-1,-1);var o=[];c(o,n.opts,t.toLowerCase()),n.search.result=o}}function p(e,n,o){var i=g.clone();if(x.searchBar&&0==n){var c=b.clone();c.prependTo(i)}var p={element:i,position:o,opts:e,activeSubmenu:-1,search:{input:c?c.find("input"):null,result:null}};T.push(p),t(n).scroll(function(){a(n,-1),l(n+1)}),s(-1,-1),M={cmIndex:n,optIndex:-1},i.appendTo(document.body),r(n),u(n),c&&p.search.input.on("input",function(){l(n+1),d(n),r(n),u(n,!0,!1)}).focus()}function m(e,t){var o=n(e,!1)[t];return void 0===o.separator&&(void 0===o.disabled||!o.disabled)}function f(e,n,t){var i=o(e);n>=i.length?n=0:n<0&&(n=i.length-1);for(var s=n;!m(e,s);){if((s+=t?-1:1)==n)return-1;s>=i.length?s=0:s<0&&(s=i.length-1)}return s}function h(){if(null==M||M.optIndex==-1){var e=T.length-1,t=n(e);if(t.length<=0)return;return void s(e,t.length-1)}var o=f(M.cmIndex,M.optIndex-1,!0);o!=-1&&s(M.cmIndex,o)}function v(){if(null==M||M.optIndex==-1){var e=T.length-1;if(n(e).length<=0)return;return void s(e,0)}var t=f(M.cmIndex,M.optIndex+1,!1);t!=-1&&s(M.cmIndex,t)}var x={minWidth:null,maxHeight:null,autoClose:!1,searchBar:!1,searchBarPlaceholder:"Search...",zIndex:50},g=$("<div>").addClass("context-menu").append($("<div>").addClass("context-menu-options")),w=$("<div>"),b=$("<div>").addClass("context-menu-search").append($("<input>").prop({type:"text",placeholder:x.searchBarPlaceholder})),I=$("<i>").addClass("option-icon"),C=$("<span>").addClass("option-text"),y=$("<hr>").addClass("option-separator"),T=[],M=null;return $(document).on("mousedown.scm contextmenu.scm",".context-menu, .opt-text, .opt-icon, .opt-separator",function(e){e.stopPropagation()}),$(document).on("keydown.scm",function(e){if("Escape"!=e.key&&27!=e.which||l(),T.length>0)if("ArrowUp"==e.key||38==e.which)e.preventDefault(),h();else if("ArrowDown"==e.key||40==e.which)e.preventDefault(),v();else if("Enter"==e.key||13==e.which)e.preventDefault(),i(M.cmIndex,M.optIndex).click();else if("ArrowLeft"==e.key||37==e.which){if(null!=M&&M.cmIndex>0){e.preventDefault();var n=M.cmIndex-1,t=T[n],o=t.activeSubmenu;l(M.cmIndex),a(n,-1),s(n,o)}}else if(("ArrowRight"==e.key||39==e.which)&&null!=M&&M.optIndex!=-1){var r=i(M.cmIndex,M.optIndex);r.hasClass("context-menu-submenu")&&(e.preventDefault(),r.trigger("submenu"))}}),$(document).on("mousedown.scm",function(){l()}),$(window).on("scroll.scm resize.scm",function(){l()}),{settings:x,createMenu:function(e,n){l(),p(e,0,{x:n.pageX,y:n.pageY})},destroyMenu:function(){l()},updateMenu:function(e,n){T.forEach(function(t,o){d(o),r(o),u(o,e,n)})},getMenuOptions:function(e){return T[e].opts},addMenuOption:function(e,n,t){void 0!==t?T[e].opts.splice(t,0,n):T[e].opts.push(n)},addMenuOptions:function(e,n,t){void 0!==t?Array.prototype.splice.apply(T[e].opts,[t,0].concat(n)):T[e].opts=T[e].opts.concat(n)},deleteMenuOption:function(e,n){T[e].opts.splice(n,1)},setMenuOption:function(e,n,t){T[e].opts[n]=t},setMenuOptions:function(e,n){T[e].opts=n}}}("Microsoft Internet Explorer"==navigator.appName||/Trident/.test(navigator.userAgent)||/rv:11/.test(navigator.userAgent));